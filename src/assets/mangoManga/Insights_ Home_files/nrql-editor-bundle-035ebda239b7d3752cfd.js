webpackJsonp([1],{1604:function(e,t,n){"use strict";function r(e){var t=this.editor=e.editor,n=this.popupManager=t.popupManager;this.cancelContextMenu=function(){t.$mouseHandler.cancelContextMenu()};var r=this;t.on("changeSelection",function(){n.dispatch("Esc"),r.detach()}),t.on("blur",function(){n.dispatch("Esc"),r.detach()}),this.commands={Up:function(e){n.dispatch("Up")},Down:function(e){n.dispatch("Down")},Esc:function(e){n.dispatch("Esc"),r.detach()},Return:function(e){n.dispatch("Return"),r.detach()},Tab:function(e){n.dispatch("Tab"),r.detach()},"Meta-Return":function(e){n.dispatch("Meta-Return"),r.detach()}},this.keyboardHandler=new v,this.keyboardHandler.bindKeys(this.commands),this.exec=function(){t.keyBinding.addKeyboardHandler(this.keyboardHandler);var e=t.renderer,r=ace.require("ace/autocomplete/util"),o=t.getSession(),a=t.getCursorPosition(),i=o.getLine(a.row),c=r.retrievePrecedingIdentifier(i,a.column);this.base=o.doc.createAnchor(a.row,a.column-c.length),this.base.$insertRight=!0;var s=this.base,l=[],u=t.completers.length;return t.completers.forEach(function(i,d){i.getCompletions(t,o,a,c,function(a,i){function c(e){var t=e.meta+"||ZANE_TOKEN||"+e.value;return!_[t]&&(_[t]=!0)}a||(l=l.concat(i));var d=t.getCursorPosition(),p=o.getLine(d.row),h=r.retrievePrecedingIdentifier(p,d.column,i[0]&&i[0].identifierRegex),m=e.layerConfig.lineHeight,g=e.$cursorLayer.getPixelPosition(s,!0),f=t.container.getBoundingClientRect();g.top+=f.top-e.layerConfig.offset,g.left+=f.left-t.renderer.scrollLeft,g.left+=e.gutterWidth,l.length||n.reset();var _={};n.showPopup({position:g,lineHeight:m,prefix:h,completions:l.filter(c),value:o.getValue(),finished:0==--u})})}),!0},this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection"),this.editor.off("blur"),this.popupManager.reset()}}function o(e){if(!e.accountId)throw new Error("QueryEditor: Expected accountId");if(!e.isFeatureAllowed)throw new Error("QueryEditor: Expected isFeatureAllowed");if(!e.DiracQuery)throw new Error("QueryEditor: Expected DiracQuery");if(void 0!==e.initialValue&&"string"!=typeof e.initialValue)throw new TypeError("QueryEditor: Expected string (or no) initialValue");var t=ace.require("ace/mode/nrql").Mode,n=ace.edit(e.container),o=n.getSession();n.setTheme("ace/theme/nrql"),n.setValue(void 0!==e.initialValue||e.getQueryPrefix?e.initialValue||"":"SELECT"),n.clearSelection(),e.onBlur&&n.on("blur",e.onBlur),e.onFocus&&n.on("focus",e.onFocus),n.setHighlightActiveLine(!1),n.setHighlightGutterLine(!1),n.renderer.lineHeight=20,n.renderer.setShowGutter(!e.hidePrompt||e.gutterWidth),n.setAutoScrollEditorIntoView(),n.setOption("maxLines",20),n.setOption("minLines",1),n.popupManager=e.popupManager,n.useCustomAutoComplete=e.useCustomAutoComplete,n.getErrors=e.getErrors||function(e){return e},n.getQueryPrefix=e.getQueryPrefix||function(e){return e},this.updatedFont=e.updatedFont,e.updatedFont&&n.setOption("fontFamily","'Fira Mono'"),this.fontSize=e.fontSize,e.fontSize&&n.setOption("fontSize",e.fontSize+"pt"),e.container.className=e.container.className+(e.lightMode?" nrql-bar-light-mode":""),n.isFeatureAllowed=e.isFeatureAllowed,n.nrqlParser=l.NrqlParser(n.isFeatureAllowed,e.DiracQuery,e.accountId,e.substringMatch),n.completers=[{getCompletions:function(t,r,o,a,i){var c=r.doc.getValue(),s=n.getQueryPrefix()?n.getQueryPrefix()+" ":"",l=new y(o.row,0,o.row,o.column),u=r.getTextRange(l);t.nrqlParser.getCompletions({value:s+c,cursorIndex:u.length+s.length,queryPrefix:s,prefix:a},function(t,n){e.onCompletions?e.onCompletions({error:t,pos:o,prefix:a,completions:n,value:s+c},function(e,n){i(t,n)}):i(t,n)})}}],void 0!==e.gutterWidth&&(this.gutterWidth=e.gutterWidth,n.session.gutterRenderer={getWidth:function(e,t,n){return this.gutterWidth}.bind(this),getText:function(e,t){return""}}),o.setMode(new t(e.isFeatureAllowed)),o.setUseWrapMode(!0),e.hidePrompt||o.addGutterDecoration(0,"nrql_prompt"),o.setTabSize(1);var a=n._defaultHandlers.guttermousemove;n.setDefaultHandler("guttermousemove",function(e){e.x=e.domEvent.offsetX,e.y=e.domEvent.offsetY,a.call(this,e)}),n.commands.removeCommands(["gotoline","find"]),this.handleQuerySubmitted=function(e){this.aceEditor.completer&&this.aceEditor.completer.detach();var t=this.aceEditor.getSession();return this._emit("querySubmitted",{aceEditor:this.aceEditor,isValid:c(t),query:t.getValue()}),!0}.bind(this),n.commands.addCommand({name:"Return",bindKey:{win:"Return|Shift-Return|Shift-Alt-Return|Alt-Return|Ctrl-Return|Meta-Return",mac:"Return|Shift-Return|Shift-Alt-Return|Alt-Return|Ctrl-Return|Meta-Return"},exec:this.handleQuerySubmitted}),this.DiracQuery=e.DiracQuery,this.aceEditor=n,this.substringMatch=e.substringMatch,e.useCustomAutoComplete?(ace.define("ace/autocomplete",r),n.commands.addCommand(r.startCommand)):(s(this,n),n.setOptions({enableBasicAutocompletion:!0})),i(this,n)}function a(e,t,n){var r=0===n.row?0:t.length;if(!n||!n.length)return void e.removeMarker(A);var o=e.getWordRange(n[0].row,n[0].column-r);A&&e.removeMarker(A),A=e.addMarker(o,"syntax_error","syntax_error",!0)}function i(e,t){t.on("change",function(n){var r=t.getSession(),o=r.getValue();e._signal("queryChange",{aceEditor:t,isValid:c(r),newQuery:o}),setTimeout(function(){t.useCustomAutoComplete?t.commands.exec("startCustomAutocomplete",t):t.commands.exec("startAutocomplete",t);var e=t.getQueryPrefix()?t.getQueryPrefix()+" ":"",n=t.getErrors(),i=a.bind(null,r,e);n&&n.length?i(n):t.nrqlParser.getErrors(e+o,i)},0)}),t.getSession().on("changeFrontMarker",function(t,n){c(n)?e._signal("queryValid"):e._signal("queryInvalid")})}function c(e){var t=e.getMarkers(!0);return!Object.keys(t).some(function(e){var n=t[e];return"syntax_error"===n.type&&n.range.start.column&&n.range.end.column})}function s(e,t){function n(e){var t=e.getCursorPosition(),n={row:t.row,column:t.column+1},r=e.session.getTextRange({start:t,end:n});return" "===r||""===r}function r(e){var t=e.popup.getData(e.popup.getRow());if(!t)return!1;var n=!!t.prefix;return void 0!==e.completions&&(n=n||e.completions.filterText||e.completions.userSelected),n&&e.insertMatch(t),n}var o=ace.require("ace/autocomplete").FilteredList,a=(ace.require("ace/autocomplete/util"),ace.require("ace/snippets").snippetManager);k.prototype.$init=function(){w.call(this),this.popup.setOptions({maxLines:30});var e=this.popup.show;this.popup.show=function(t,n,r){e.call(this,t,n,!0)}},k.prototype.goTo=function(e){this.completions&&this.popup&&(this.completions.userSelected=!0,C.call(this,e))},o.prototype.setFilter=function(e){var t;t=e.length>this.filterText&&0===e.lastIndexOf(this.filterText,0)?this.filtered:this.all,this.filterText=e,t=this.filterCompletions(t,this.filterText),t.forEach(function(e,t){e.index=t}),t=t.sort(function(e,t){return t.exactMatch-e.exactMatch||t.score-e.score||e.index-t.index});var n=null;t=t.filter(function(e){var t=e.snippet||e.caption||e.value;return t!==n&&(n=t,!0)}),this.filtered=t},o.prototype.filterCompletions=function(e,t){var n=[];return e.forEach(function(e){var r=e.value||e.caption||e.snippet;if(r){var o=r.toLowerCase().indexOf(t.toLowerCase());-1!==o&&(e.matchMask=(1<<t.length)-1<<o,e.score=-o,n.push(e))}}),n},k.prototype.insertMatch=function(e){if(!e&&this.popup&&(e=this.popup.getData(this.popup.getRow())),!e)return!1;if(e.completer&&e.completer.insertMatch)e.completer.insertMatch(this.editor);else{var t,n,r,o,i=this.completions&&this.completions.filterText?this.completions.filterText:"";for(r=this.editor.selection.getRange(),r.end=r.start,this.editor.selection.setRange(r),o=this.editor.selection.getAllRanges(),t=0;r=o[t];++t){r.start.column-=i.length,n=this.editor.session.getLine(r.start.row);var c=e.value[0]+n[r.start.column-1];"''"!==c&&"``"!==c||--r.start.column,this.editor.session.remove(r)}e.snippet?a.insertSnippet(this.editor,e.snippet):(this.editor.execCommand("insertstring",e.value||e),!e.extension&&this.editor.tabstopManager&&(this.editor.tabstopManager.tabNext(1),this.editor.selection.clearSelection()))}return this.detach(),!0},k.prototype.updateCompletions=function(t){if(e._signal("startLoading"),t&&this.base&&this.completions){var r=this.editor.getCursorPosition(),a=this.editor.session.getTextRange({start:this.base,end:r});if(a===this.completions.filterText)return;return n(this.editor)?(this.completions.setFilter(a),this.completions.filtered.length?void this.openPopup(this.editor,a,t):this.detach()):this.detach()}this.gatherCompletions(this.editor,function(r,a){e._signal("finishLoading");var i=a&&a.matches;if(!i||!i.length)return this.detach();if(this.completions=new o(i),this.completions.setFilter(a.prefix),!this.completions.filtered.length)return this.detach();if(!n(this.editor))return this.detach();this.openPopup(this.editor,a.prefix,t);var c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=28*(e.fontSize||10);s>c&&(s=c),e.updatedFont&&this.popup.setOption("fontFamily","'Fira Mono'"),this.popup.renderer.container.style.width=s+"px"}.bind(this))},k.prototype.commands.Return=function(t){r(t.completer)||e.handleQuerySubmitted()},k.prototype.commands["Ctrl-N"]=k.prototype.commands.Down.bind(this),k.prototype.commands["Ctrl-P"]=k.prototype.commands.Up.bind(this)}var l=n(262),u=ace.require("ace/lib/oop"),d=ace.require("ace/mode/text_highlight_rules").TextHighlightRules,p=function(e){var t="select|from|since|until|compare|with|ago|begin|end|for|in|begintime|endtime|where|facet|cohort|offset|limit|like|timeseries|events|and|or|is|not|as";e("join_data_sources")&&(t+="|lookup"),e("nrql_filter_function")&&(t+="|filter");var n="null|second|minute|hour|day|week|month|auto|seconds|minutes|hours|days|weeks|months";e("nrql_since_today_syntax")&&(t+="|at|timezone",n+="|today|yesterday|this|last|year|quarter|sunday|monday|tuesday|wednesday|thursday|friday|saturday");var r=this.createKeywordMapper({"support.function":"count|uniques|uniquecount|min|max|average|sum|percentile|keyset|hourlyuniques|duration|averageduration|apdex|conversions|histogram|funnel|percentage|buckets|cases|dateOf|weekdayOf|hourOf|weekOf|monthOf|yearOf|dayOfMonthOf|quarterOf|filter",keyword:t,"constant.language":n},"identifier",!0);this.$rules={start:[{token:"string.identifier",regex:"`.*?`"},{token:"string",regex:"'(?:[^'\\\\]|\\\\.)*?'"},{token:"string.incomplete",regex:"'.*?$"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:r,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*(?!:)\\b"},{token:"keyword.operator",regex:"\\+|\\-|\\/|\\*|<|>|<=|=>|==|!=|="},{token:"paren.lparen",regex:"[\\(]"},{token:"paren.rparen",regex:"[\\)]"},{token:"text",regex:"\\s+"}]}};u.inherits(p,d);var h=ace.require("ace/lib/oop"),m=ace.require("ace/mode/text").Mode,g=ace.require("ace/tokenizer").Tokenizer,f=function(e){var t=new p(e||function(){return!1});this.$tokenizer=new g(t.getRules()),this.$keywordList=t.$keywordList};h.inherits(f,m),f.prototype.$id="ace/mode/nrql";var _={Mode:f},b={isDark:!0,cssClass:"ace-nrql",cssText:".ace_editor {\n  overflow: visible !important;\n}\n\n.ace-nrql .syntax_error {\n  box-sizing: border-box;\n  border-bottom: 1px solid red;\n  position: absolute;\n}\n\n.ace-nrql.nrql-bar-light-mode .syntax_error {\n  border-bottom: 2px solid #ff667a;\n  border-radius: 0;\n}\n\n.ace_gutter-cell {\n  padding-left: 15px !important;\n  padding-right: 2.8em !important;\n  width: 8em;\n  text-align: left;\n\n  /* Don't show line number. */\n  color: transparent;\n}\n\n.ace_gutter-cell.nrql_prompt::before {\n  color: #b9ca4a;\n  content: 'NRQL>';\n}\n\n.ace_gutter-tooltip {\n  position: absolute !important;\n}\n\n.ace-nrql .ace_gutter {\n  /*background: #1a1a1a;*/\n  /*color: #76df2c;*/\n  color: #B9CA4A\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_gutter {\n  color: #71ba02;\n}\n\n.ace-nrql .ace_print-margin {\n  width: 1px;\n  background: #1a1a1a\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_print-margin {\n  background: transparent\n}\n\n.ace-nrql {\n  background-color: #000;\n  color: #DEDEDE\n}\n\n.ace-nrql.nrql-bar-light-mode {\n  background-color: transparent;\n  color: #464e4e;\n}\n\n.ace-nrql .ace_cursor {\n  border-left: 2px solid #9F9F9F\n}\n\n.ace-nrql .ace_overwrite-cursors .ace_cursor {\n  border-left: 0px;\n  border-bottom: 1px solid #424242\n}\n\n.ace-nrql .ace_marker-layer .ace_selection {\n  background: #424242\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_marker-layer .ace_selection {\n  background: rgba(0,0,0,0.075)\n}\n\n.ace-nrql.ace_multiselect .ace_selection.ace_start {\n  box-shadow: 0 0 3px 0px #000000;\n  border-radius: 2px\n}\n\n.ace-nrql.ace_multiselect.nrql-bar-light-mode .ace_selection.ace_start {\n  box-shadow: 0 0 3px 0px #AEAEAE;\n}\n\n.ace-nrql .ace_marker-layer .ace_step {\n  background: rgb(102, 82, 0)\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_marker-layer .ace_step {\n  background: rgba(102, 82, 0, 0.25)\n}\n\n.ace-nrql .ace_marker-layer .ace_bracket {\n  margin: -1px 0 0 -1px;\n  border: 1px solid #343434\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_marker-layer .ace_bracket {\n  border: 1px solid #AEAEAE\n}\n\n.ace-nrql .ace_marker-layer .ace_active-line {\n  background: #2A2A2A\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_marker-layer .ace_active-line {\n  background: rgba(0,0,0,0.075)\n}\n\n.ace-nrql .ace_gutter-active-line {\n  background-color: #2A2A2A\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_gutter-active-line {\n  background-color: #9F9F9F\n}\n\n.ace-nrql .ace_marker-layer .ace_selected-word {\n  border: 1px solid #424242\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_marker-layer .ace_selected-word {\n  border: 0\n}\n\n.ace-nrql .ace_invisible {\n  color: #343434\n}\n\n.ace-nrql .ace_keyword,\n.ace-nrql .ace_meta,\n.ace-nrql .ace_storage,\n.ace-nrql .ace_storage.ace_type,\n.ace-nrql .ace_support.ace_type {\n  color: #C397D8\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_keyword,\n.ace-nrql.nrql-bar-light-mode .ace_meta,\n.ace-nrql.nrql-bar-light-mode .ace_storage,\n.ace-nrql.nrql-bar-light-mode .ace_storage.ace_type,\n.ace-nrql.nrql-bar-light-mode .ace_support.ace_type {\n  color: #aa1bc8;\n}\n\n.ace-nrql .ace_keyword.ace_operator {\n  color: #70C0B1\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_keyword.ace_operator {\n  color: #19b1bb\n}\n\n.ace-nrql .ace_constant.ace_character,\n.ace-nrql .ace_constant.ace_language,\n.ace-nrql .ace_constant.ace_numeric,\n.ace-nrql .ace_keyword.ace_other.ace_unit,\n.ace-nrql .ace_support.ace_constant,\n.ace-nrql .ace_variable.ace_parameter {\n  color: #E78C45\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_constant.ace_character,\n.ace-nrql.nrql-bar-light-mode .ace_constant.ace_language,\n.ace-nrql.nrql-bar-light-mode .ace_constant.ace_numeric,\n.ace-nrql.nrql-bar-light-mode .ace_keyword.ace_other.ace_unit,\n.ace-nrql.nrql-bar-light-mode .ace_support.ace_constant,\n.ace-nrql.nrql-bar-light-mode .ace_variable.ace_parameter {\n  color: #dd9715\n}\n\n.ace-nrql .ace_constant.ace_other {\n  color: #EEEEEE\n}\n\n.ace-nrql .ace_invalid {\n  color: #CED2CF;\n  background-color: #DF5F5F\n}\n\n.ace-nrql .ace_invalid.ace_deprecated {\n  color: #CED2CF;\n  background-color: #B798BF\n}\n\n.ace-nrql .ace_fold {\n  background-color: #7AA6DA;\n  border-color: #DEDEDE\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_fold {\n  background-color: #3083e1\n}\n\n.ace-nrql .ace_entity.ace_name.ace_function,\n.ace-nrql .ace_support.ace_function,\n.ace-nrql .ace_variable {\n  color: #7AA6DA\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_entity.ace_name.ace_function,\n.ace-nrql.nrql-bar-light-mode .ace_support.ace_function,\n.ace-nrql.nrql-bar-light-mode .ace_variable {\n  color: #3083e1;\n}\n\n.ace-nrql .ace_support.ace_class,\n.ace-nrql .ace_support.ace_type {\n  color: #E7C547\n}\n\n.ace-nrql .ace_heading,\n.ace-nrql .ace_string {\n  color: #B9CA4A\n}\n\n.ace-nrql.nrql-bar-light-mode .ace_heading,\n.ace-nrql.nrql-bar-light-mode .ace_string {\n  color: #71ba02\n}\n\n.ace-nrql .ace_entity.ace_name.ace_tag,\n.ace-nrql .ace_entity.ace_other.ace_attribute-name,\n.ace-nrql .ace_meta.ace_tag,\n.ace-nrql .ace_string.ace_regexp,\n.ace-nrql .ace_variable {\n  color: #D54E53\n}\n\n.ace-nrql .ace_comment {\n  color: #969896\n}\n\n.ace-nrql .ace_indent-guide {\n  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWNgYGBgYFBXV/8PAAJoAXX4kT2EAAAAAElFTkSuQmCC) right repeat-y;\n}\n"};ace.require("ace/lib/dom").importCssString(b.cssText,b.cssClass);var q=ace.require("ace/lib/oop"),y=ace.require("ace/range").Range,x=ace.require("ace/lib/event_emitter").EventEmitter,v=ace.require("ace/keyboard/hash_handler").HashHandler,E=ace.require("ace/autocomplete/util");ace.define("ace/mode/nrql",_),ace.define("ace/theme/nrql",b),r.startCommand={name:"startCustomAutocomplete",exec:function(e){e.completer||(e.completer=new r({editor:e})),e.completer.autoInsert=!1,e.completer.autoSelect=!0,e.completer.exec(),e.completer.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"},r.prototype.commands={Return:function(e){}},e.exports=o,function(){this.setAccountId=function(e){this.aceEditor.nrqlParser=l.NrqlParser(this.aceEditor.isFeatureAllowed,this.DiracQuery,e,this.substringMatch)},this.insertAtCurrentPos=function(e){var t=this.aceEditor.getCursorPosition(),n=this.aceEditor.getSession().getLine(t.row),r=E.retrievePrecedingIdentifier(n,t.column),o=this.aceEditor.selection.getRange();o.end=o.start,this.aceEditor.selection.setRange(o);for(var a=this.aceEditor.selection.getAllRanges(),i=0;o=a[i];++i){o.start.column-=r.length;var n=this.aceEditor.session.getLine(o.start.row),c=e[0]+n[o.start.column-1];"''"!==c&&"``"!==c||--o.start.column,this.aceEditor.session.remove(o)}this.aceEditor.execCommand("insertstring",e),this.aceEditor.focus()},this.getValue=function(){return this.aceEditor.getSession().getValue()},this.isQueryValid=function(){return c(this.aceEditor.getSession())},this.setValue=function(e,t){var n=this.aceEditor;n.setValue(e),n.navigateFileEnd(),t?this.focus():n.completer&&n.completer.popup&&n.completer.popup.hide()},this.focus=function(){this.aceEditor.focus()},this.destroy=function(){var e=this.aceEditor;e.getSession().$stopWorker();var t=e.completer&&e.completer.popup;t&&(t.destroy(),t.container.parentNode.removeChild(t.container)),e.destroy()},q.implement(this,x)}.call(o.prototype);var A,k=ace.require("ace/autocomplete").Autocomplete,w=k.prototype.$init,C=k.prototype.goTo}});
//# sourceMappingURL=nrql-editor-bundle-035ebda239b7d3752cfd.js.map